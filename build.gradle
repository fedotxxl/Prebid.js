buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath "com.netflix.nebula:gradle-ospackage-plugin:2.2.6"
    }
}

apply plugin: "rpm"

group = "com.alfadart"
version = "1.5"

project.ext {
    applicationName = "alfadart-js-prebid"
}

task npmInstall(type: Exec) {
    workingDir "./"
    commandLine "npm", "install"
}

task buildProd(type: Exec, dependsOn: ":npmInstall") {
    workingDir "./"
    commandLine "gulp", "build", "--modules=modules.json"
}

task rpm(type: Rpm, dependsOn: ":buildProd") {
    packageName = project.ext.applicationName
    version = project.version
    arch = NOARCH
    os = LINUX

    into "/"

    from("./build/dist/prebid.js") {
        into "/opt/alfadart-cdn/js/libs/"
    }
}
